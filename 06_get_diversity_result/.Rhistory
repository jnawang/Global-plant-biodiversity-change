expansion_ESM370 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/range_expansionR_ESM_370_2081-2100.tif')
expansion_ESM585 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/range_expansionR_ESM_585_2081-2100.tif')
plot(expansion_ESM126/richnessP)
plot(expansion_ESM245/richnessP)
plot(expansion_ESM370/richnessP)
plot(expansion_ESM585/richnessP)
#
# Retraction
Retraction_ESM126 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/retraction_ESM_126_2081-2100.tif')
Retraction_ESM245 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/retraction_ESM_245_2081-2100.tif')
Retraction_ESM370 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/retraction_ESM_370_2081-2100.tif')
Retraction_ESM585 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/retraction_ESM_585_2081-2100.tif')
plot(Retraction_ESM126/richnessP)
plot(Retraction_ESM245/richnessP)
plot(Retraction_ESM370/richnessP)
plot(Retraction_ESM585/richnessP)
#
#
richnessF_ESM126 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richnessF_ESM_126_2081-2100.tif')
richnessF_ESM245 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richnessF_ESM_245_2081-2100.tif')
richnessF_ESM370 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richnessF_ESM_370_2081-2100.tif')
richnessF_ESM585 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richnessF_ESM_585_2081-2100.tif')
#
richnessPF_ESM126 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richness_PresFut_ESM_126_2081-2100.tif')
richnessPF_ESM245 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richness_PresFut_ESM_245_2081-2100.tif')
richnessPF_ESM370 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richness_PresFut_ESM_370_2081-2100.tif')
richnessPF_ESM585 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/richness_PresFut_ESM_585_2081-2100.tif')
# sink all future
sinkF_all_ESM126 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/sinkF_all_ESM_126_2081-2100.tif')
sinkF_all_ESM245 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/sinkF_all_ESM_245_2081-2100.tif')
sinkF_all_ESM370 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/sinkF_all_ESM_370_2081-2100.tif')
sinkF_all_ESM585 <- terra::rast('/Users/junnawang/Downloads/richness_maxe/sinkF_all_ESM_585_2081-2100.tif')
#
# dispersal limitation is much smaller; but dispersal limitation increases with warming rates!
plot((richnessF_ESM126-richnessR_ESM126) / mask(sinkF_all_ESM126, bio1_no_lakes), range = c(0, 1))
plot((richnessF_ESM245-richnessR_ESM245) / mask(sinkF_all_ESM245, bio1_no_lakes), range = c(0, 1))
plot((richnessF_ESM370-richnessR_ESM370) / mask(sinkF_all_ESM370, bio1_no_lakes), range = c(0, 1))
plot((richnessF_ESM585-richnessR_ESM585) / mask(sinkF_all_ESM585, bio1_no_lakes), range = c(0, 1))
plot((richnessF_ESM126-richnessR_ESM126) / mask(sinkF_all_ESM126, bio1_no_lakes)) # , range = c(0, 1)
plot((richnessF_ESM245-richnessR_ESM245) / mask(sinkF_all_ESM245, bio1_no_lakes))
plot((richnessF_ESM370-richnessR_ESM370) / mask(sinkF_all_ESM370, bio1_no_lakes))
plot((richnessF_ESM585-richnessR_ESM585) / mask(sinkF_all_ESM585, bio1_no_lakes))
plot(bio1_no_lakes)
source("~/UCDLab/Biodiversity/pre_post_processing/06_get_diversity_result/grid_diversity_uncertainty.R")
dirname(rstudioapi::getActiveDocumentContext()$path)
dirname(rstudioapi::getActiveDocumentContext()$path)
source("~/UCDLab/Biodiversity/pre_post_processing/06_get_diversity_result/grid_diversity_uncertainty.R")
ifile = 100
df_richness_change <- data.frame(SDM=c(rep('MAXE', 80), rep('RFDS', 80)), ESM=rep(rep(c('ACCESS', 'ESM', 'MIROC6', 'MPIESM'), each=4), 10),
CO2=rep(c('ssp126', 'ssp245', 'ssp370', 'ssp585'), 40) ,
migration=rep(rep(c('full', 'no', 'med', 'slow', 'fast'), each=16), 2), change=0)
#
# divide the earth into multiple chunks
# dimensions  : 1761, 4333, 1 (row, col)
landcells <- which(!is.na(terra::values(template_land)))
nrow <- nrow(template_land)
ncol <- ncol(template_land)
ncell <- length(landcells)
#
ncell.file <- 7200
id.start   <- (ifile - 1) * ncell.file + 1
id.end     <- min(ifile*ncell.file, ncell)
cells.file <- landcells[id.start:id.end]
#
output <- data.frame(GID=integer(), std_maxe=double(), SDM_maxe=double(), ESM_maxe=double(), CO2_maxe=double(), migration_maxe=double(), residual_maxe=double(),
std_rfds=double(), SDM_rfds=double(), ESM_rfds=double(), CO2_rfds=double(), migration_rfds=double(), residual_maxe=double())
#
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
cells.file
mtx_maxe <- terra::values(richness_change_maxe)[, cells.file]
terra::values(richness_change_maxe)
mtx_maxe <- terra::values(richness_change_maxe)[cells.file, ]
uncertainty(mtx_maxe[1,])
mtx_maxe[1,]
sd(as.numeric(mtx_maxe[1,]))
df_richness_change$change <- as.numeric(mtx_maxe[1,]
)
summary(aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit))
r1 <- apply(mtx_maxe, 1, uncertainty)
r1 <- mapply(mtx_maxe, 1, uncertainty)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
#
mtx_maxe <- terra::values(richness_change_maxe)[cells.file, ]
r1 <- mapply(mtx_maxe, 1, uncertainty)
View(mtx_maxe)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
r1 <- apply(mtx_maxe, 1, uncertainty)
uncertainty(mtx_maxe[2,])
uncertainty <- function(change_ratio) {
df_richness_change$change <- as.numeric(change_ratio)
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
r1 <- apply(mtx_maxe, 1, uncertainty)
r1 <- apply(mtx_maxe, 1, uncertainty)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
print(df_richness_change)
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
print(df_richness_change)
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
r1 <- apply(mtx_maxe, 1, uncertainty)
mtx_maxe <- terra::values(richness_change_maxe)[cells.file, ]
mtx_rfds <- terra::values(richness_change_rfds)[cells.file, ]
mtx <- rbind(mtx_maxe, mtx_rfds)
r1 <- apply(mtx, 1, uncertainty)
mtx <- cbind(mtx_maxe, mtx_rfds)
mtx <- cbind(mtx_maxe, mtx_rfds)
r1 <- apply(mtx[1,], 1, uncertainty)
View(mtx)
uncertainty(mtx[1,])
r1 <- apply(mtx[1,], 1, uncertainty)
r1 <- apply(mtx[1,], 1, uncertainty)
r1 <- apply(mtx[1:2,], 1, uncertainty)
View(r1)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(df_richness_change)
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(df_richness_change)
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
}
r1 <- pbapply(mtx, 1, uncertainty)
library(pbapply)
r1 <- pbapply(mtx, 1, uncertainty)
r1 <- pbapply(mtx[1:10,], 1, uncertainty)
r1 <- pbapply(mtx[1:100,], 1, uncertainty)
r1 <- pbapply(mtx[86:87,], 1, uncertainty)
r1 <- pbapply(mtx[87:88,], 1, uncertainty)
mtx[87,]
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(df_richness_change)
if (sum(is.na(change_ratio)) > 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
r1 <- pbapply(mtx[87:88,], 1, uncertainty)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
print(change_ratio)
if (sum(is.na(change_ratio)) > 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
r1 <- pbapply(mtx[87:88,], 1, uncertainty)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
print(change_ratio)
if (sum(is.na(change_ratio)) == 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
r1 <- pbapply(mtx[87:88,], 1, uncertainty)
r1 <- pbapply(mtx[1:1000,], 1, uncertainty)
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(change_ratio)
if (sum(is.na(change_ratio)) == 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(change_ratio)
if (sum(is.na(change_ratio)) == 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
r1 <- pbapply(mtx[,], 1, uncertainty)
View(r1)
5*250/60
df_richness_change <- data.frame(SDM=c(rep('MAXE', 80), rep('RFDS', 80)), ESM=rep(rep(c('ACCESS', 'ESM', 'MIROC6', 'MPIESM'), each=4), 10),
CO2=rep(c('ssp126', 'ssp245', 'ssp370', 'ssp585'), 40) ,
migration=rep(rep(c('full', 'no', 'med', 'slow', 'fast'), each=16), 2), change=0)
#
# divide the earth into multiple chunks
# dimensions  : 1761, 4333, 1 (row, col)
landcells <- which(!is.na(terra::values(template_land)))
nrow <- nrow(template_land)
ncol <- ncol(template_land)
ncell <- length(landcells)
#
ifile <- 1
ncell.file <- ncell
id.start   <- (ifile - 1) * ncell.file + 1
id.end     <- min(ifile*ncell.file, ncell)
cells.file <- landcells[id.start:id.end]
output <- data.frame(GID=integer(), std=double(), SDM=double(), ESM=double(), CO2=double(), migration=double(), residual=double())
#
uncertainty <- function(change_ratio) {
df_richness_change$change <- change_ratio
#  print(change_ratio)
if (sum(is.na(change_ratio)) == 0) {
fit <- aov(change ~ SDM + ESM + CO2 + migration, df_richness_change, na.action = na.omit)
return(c(sd(change_ratio, na.rm=T), summary(fit)[[1]][["Sum Sq"]]))
} else {
return(rep(NA, 6))
}
}
#
mtx_maxe <- terra::values(richness_change_maxe)[cells.file, ]
mtx_rfds <- terra::values(richness_change_rfds)[cells.file, ]
mtx <- cbind(mtx_maxe, mtx_rfds)
cl <- parallel::makeCluster(detectCores() - 1)  # Use all cores minus 1
library(parallel)
cl <- parallel::makeCluster(detectCores() - 1)  # Use all cores minus 1
cl
parallel::clusterExport(cl, varlist = "df_richness_change")
r1 <- pbapply(mtx[1:1000,], 1, uncertainty, cl = cl)
r1 <- pbapply(mtx[1:100000,], 1, uncertainty, cl = cl)
View(r1)
r1 <- pbapply(mtx, 1, uncertainty, cl = cl)
output$GID <- landcells
#
parallel::stopCluster(cl)
View(r1)
ncol(r1)
terra::values(template_land)[landcells] <- r1[1,]
#
plot(template_land)
template_land <- terra::rast('bio1_remove_lakes.tif')
richness_change_sd <- template_land
terra::values(richness_change_sd)[landcells] <- r1[1,]
plot(richness_change_sd)
richness_change_SDM <- template_land
terra::values(richness_change_sd)[landcells] <- r1[2,] / colSums(r1[2:6,])
plot(richness_change_sd)
richness_change_SDM <- template_land
terra::values(richness_change_SDM)[landcells] <- r1[2,] / colSums(r1[2:6,])
plot(richness_change_SDM)
richness_change_ESM <- template_land
terra::values(richness_change_ESM)[landcells] <- r1[3,] / colSums(r1[2:6,])
plot(richness_change_ESM)
richness_change_CO2 <- template_land
terra::values(richness_change_CO2)[landcells] <- r1[4,] / colSums(r1[2:6,])
plot(richness_change_CO2)
richness_change_CO2 <- template_land
terra::values(richness_change_CO2)[landcells] <- r1[4,] / colSums(r1[2:6,])
plot(richness_change_CO2, main='CO2 scenarios')
richness_change_migration <- template_land
terra::values(richness_change_migration)[landcells] <- r1[5,] / colSums(r1[2:6,])
plot(richness_change_migration, main='Contribution of migration')
richness_change_residual <- template_land
terra::values(richness_change_residual)[landcells] <- r1[6,] / colSums(r1[2:6,])
plot(richness_change_residual, main='Contribution of residual')
source("~/UCDLab/Biodiversity/pre_post_processing/06_get_diversity_result/grid_diversity_uncertainty.R")
richness_change_sd <- template_land
terra::values(richness_change_sd)[landcells] <- r1[1,]
plot(richness_change_sd)
library(terra)
library(SpatialPack)
#
change_prec <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12_ESM_245_2081-2100.tif') -
terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12.tif')
plot(change_prec)
prec <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12.tif')
change_prec_rel <- change_prec / prec
plot(change_prec_rel)
#
change_temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1_ESM_245_2081-2100.tif') -
terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
plot(change_temp)
#
# this one should be alternating 0 and 1
mountain <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/k3binary5m.tif')
terra::values(mountain)[is.na(terra::values(mountain))] <- 0
mountain <- mask(mountain, change_temp)
plot(mountain)
#
richness_presfut <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/richness_PresFut_ESM_245_2081-2100_MAXE_RFDS.tif')
richnessP <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/richnessP_MAXE_RFDS.tif')
#
migration_in <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/sinkR_ESM_245_2081-2100_MAXE_RFDS.tif')
migration_in <- migration_in / richness_presfut
plot(migration_in)
#
migration_out <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/sourceR_ESM_245_2081-2100_MAXE_RFDS.tif')
migration_out <- migration_out / richness_presfut
plot(migration_out)
#
persist <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/persistR_ESM_245_2081-2100_MAXE_RFDS.tif')
persist <- persist / richness_presfut
plot(persist)
#
richness      <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/richnessP_MAXE_RFDS.tif")
contraction   <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/range_contractionR_ESM_245_2081-2100_MAXE_RFDS.tif")
contraction   <- contraction / richness
plot(contraction)
#
expansion     <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/range_expansionR_ESM_245_2081-2100_MAXE_RFDS.tif")
expansion     <- expansion / richness
plot(expansion)
#
extinction    <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure2_extinction/extinction_habitat_loss_ESM_245_2081-2100_MAXE_RFDS.tif")
extinction    <- extinction / richness
plot(extinction)
#
change_alpha_div <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/richnessR_ESM_245_2081-2100_MAXE_RFDS.tif')
change_alpha_div <- change_alpha_div / richness
plot(change_alpha_div)
#
#
betadiv.pre <- richness
terra::values(betadiv.pre) <- NA
betadiv.fut <- betadiv.pre
#
# current beta diversity
val.pre <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/beta_diversity_present_MAXE_RFDS.csv')
terra::values(betadiv.pre)[val.pre$cell] <- val.pre$SOR
#
# future beta diversity
val.fut <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/beta_diversity_Realized_ESM_245_2081-2100_MAXE_RFDS.csv')
terra::values(betadiv.fut)[val.fut$cell] <- val.fut$SOR
# plot(betadiv.pre)
# plot(betadiv.fut)
# calculate beta diversity change
change_beta_div <- betadiv.fut / betadiv.pre
plot(change_beta_div)
#############phylo-diversity
phylodiv.pre <- richness
terra::values(phylodiv.pre) <- NA
phylodiv.fut <- phylodiv.pre
#
# current beta diversity
val.pre <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/phylo_diversity_present_MAXE_RFDS.csv')
terra::values(phylodiv.pre)[val.pre$GID] <- val.pre$pd
#
# future beta diversity
val.fut <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/phylo_diversity_Realized_ESM_245_2081-2100_MAXE_RFDS.csv')
terra::values(phylodiv.fut)[val.fut$GID] <- val.fut$pd
#
# calculate beta diversity change
change_phylo_div <- phylodiv.fut / phylodiv.pre
plot(change_phylo_div)
#
cor.test(terra::values(change_phylo_div), terra::values(change_alpha_div))   # 0.9631636
#########################correlation between changes in alpha and beta diversity#################################
cor.test(terra::values(change_beta_div), terra::values(change_alpha_div))    # -0.5189336
#####################################################calculate correlations among these maps
global_cells <- which(!is.na(terra::values(richness)))
random_cells <- sample(1:length(global_cells), 20000, replace=F)
random_cells <- global_cells[random_cells]
coords <- xyFromCell(richness, random_cells)
#
# random_cells_mid; corresponding to around 4000000.
random_cells_mid <- random_cells[abs(coords[,2]) < 4000000]
coords_mid <- xyFromCell(richness, random_cells_mid)
# random_cells_north
random_cells_north <- random_cells[coords[,2] > 4000000]
coords_north <- xyFromCell(richness, random_cells_north)
#
modified.ttest(terra::values(migration_in)[random_cells_mid], terra::values(change_prec_rel)[random_cells_mid], coords_mid)
modified.ttest(terra::values(change_alpha_div)[random_cells_mid], terra::values(change_prec)[random_cells_mid], coords_mid)
library(terra)
library(SpatialPack)
#
change_prec <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12_ESM_245_2081-2100.tif') -
terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12.tif')
plot(change_prec)
prec <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio12.tif')
change_prec_rel <- change_prec / prec
plot(change_prec_rel)
#
change_temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1_ESM_245_2081-2100.tif') -
terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
plot(change_temp)
#
# this one should be alternating 0 and 1
mountain <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/k3binary5m.tif')
terra::values(mountain)[is.na(terra::values(mountain))] <- 0
mountain <- mask(mountain, change_temp)
plot(mountain)
#
richness_presfut <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/richness_PresFut_ESM_245_2081-2100_MAXE_RFDS.tif')
richnessP <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/richnessP_MAXE_RFDS.tif')
#
migration_in <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/sinkR_ESM_245_2081-2100_MAXE_RFDS.tif')
migration_in <- migration_in / richness_presfut
plot(migration_in)
#
migration_out <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/sourceR_ESM_245_2081-2100_MAXE_RFDS.tif')
migration_out <- migration_out / richness_presfut
plot(migration_out)
#
persist <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure3_migration/persistR_ESM_245_2081-2100_MAXE_RFDS.tif')
persist <- persist / richness_presfut
plot(persist)
#
richness      <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/richnessP_MAXE_RFDS.tif")
contraction   <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/range_contractionR_ESM_245_2081-2100_MAXE_RFDS.tif")
contraction   <- contraction / richness
plot(contraction)
#
expansion     <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/FigureS_range_expansion_contraction/range_expansionR_ESM_245_2081-2100_MAXE_RFDS.tif")
expansion     <- expansion / richness
plot(expansion)
#
extinction    <- terra::rast("/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure2_extinction/extinction_habitat_loss_ESM_245_2081-2100_MAXE_RFDS.tif")
extinction    <- extinction / richness
plot(extinction)
#
change_alpha_div <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/richnessR_ESM_245_2081-2100_MAXE_RFDS.tif')
change_alpha_div <- change_alpha_div / richness
plot(change_alpha_div)
#
#
betadiv.pre <- richness
terra::values(betadiv.pre) <- NA
betadiv.fut <- betadiv.pre
#
# current beta diversity
val.pre <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/beta_diversity_present_MAXE_RFDS.csv')
terra::values(betadiv.pre)[val.pre$cell] <- val.pre$SOR
#
# future beta diversity
val.fut <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/beta_diversity_Realized_ESM_245_2081-2100_MAXE_RFDS.csv')
terra::values(betadiv.fut)[val.fut$cell] <- val.fut$SOR
# plot(betadiv.pre)
# plot(betadiv.fut)
# calculate beta diversity change
change_beta_div <- betadiv.fut / betadiv.pre
plot(change_beta_div)
#############phylo-diversity
phylodiv.pre <- richness
terra::values(phylodiv.pre) <- NA
phylodiv.fut <- phylodiv.pre
#
# current beta diversity
val.pre <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/phylo_diversity_present_MAXE_RFDS.csv')
terra::values(phylodiv.pre)[val.pre$GID] <- val.pre$pd
#
# future beta diversity
val.fut <- read.csv('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/Figure4_S7_S8a_global_diversity/phylo_diversity_Realized_ESM_245_2081-2100_MAXE_RFDS.csv')
terra::values(phylodiv.fut)[val.fut$GID] <- val.fut$pd
#
# calculate beta diversity change
change_phylo_div <- phylodiv.fut / phylodiv.pre
plot(change_phylo_div)
#
cor.test(terra::values(change_phylo_div), terra::values(change_alpha_div))   # 0.9631636
#########################correlation between changes in alpha and beta diversity#################################
cor.test(terra::values(change_beta_div), terra::values(change_alpha_div))    # -0.5189336
#####################################################calculate correlations among these maps
global_cells <- which(!is.na(terra::values(richness)))
random_cells <- sample(1:length(global_cells), 20000, replace=F)
random_cells <- global_cells[random_cells]
coords <- xyFromCell(richness, random_cells)
#
# random_cells_mid; corresponding to around 4000000.
random_cells_mid <- random_cells[abs(coords[,2]) < 4000000]
coords_mid <- xyFromCell(richness, random_cells_mid)
# random_cells_north
random_cells_north <- random_cells[coords[,2] > 4000000]
coords_north <- xyFromCell(richness, random_cells_north)
modified.ttest(terra::values(extinction)[random_cells], terra::values(change_prec)[random_cells], coords)
# sample correlation: -0.136; p-value: 0.1356
modified.ttest(terra::values(migration_in)[random_cells_mid], terra::values(change_prec_rel)[random_cells_mid], coords_mid)
modified.ttest(terra::values(change_alpha_div)[random_cells], terra::values(change_prec)[random_cells], coords)
modified.ttest(terra::values(migration_in)[random_cells_mid], terra::values(change_prec)[random_cells_mid], coords_mid)
modified.ttest(terra::values(contraction)[random_cells], terra::values(contraction)[random_cells], coords)
modified.ttest(terra::values(contraction)[random_cells_mid], terra::values(prec)[random_cells_mid], coords_mid)
# sample correlation: -0.3601; p-value: 2e-04
modified.ttest(terra::values(expansion)[random_cells_mid], terra::values(change_prec)[random_cells_mid], coords_mid)
modified.ttest(terra::values(expansion)[random_cells_mid], terra::values(prec)[random_cells_mid], coords_mid)
modified.ttest(terra::values(expansion)[random_cells_mid], terra::values(change_temp)[random_cells_mid], coords_mid)
modified.ttest(terra::values(change_alpha_div)[random_cells_mid], terra::values(change_prec)[random_cells_mid], coords_mid)
modified.ttest(terra::values(change_alpha_div)[random_cells_mid], terra::values(change_prec_rel)[random_cells_mid], coords_mid)
modified.ttest(terra::values(change_alpha_div)[random_cells_mid], terra::values(change_temp)[random_cells_mid], coords_mid)
temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
temp <- terra::rast('/Users/junnawang/UCDLab/Biodiversity/Results/2024/Figures/temp_prep_change/bio1.tif')
modified.ttest(terra::values(expansion)[random_cells_mid], terra::values(temp)[random_cells_mid], coords_mid)
